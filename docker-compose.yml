services:
  relay:
    build: ./relay
    container_name: p2p-relay
    restart: unless-stopped
    ports:
      - "4003:4003/tcp"
      - "4003:4003/udp"
    environment:
      - RELAY_LISTEN=/ip4/0.0.0.0/tcp/4003
      - RELAY_PRIVATE=false
    volumes:
      - relay-data:/data

  node1:
    build: ./node
    container_name: p2p-node-1
    restart: unless-stopped
    environment:
      - APP_ROOM=${APP_ROOM}
      - RELAY_ADDR=${RELAY_ADDR}
      - LISTEN_TCP=/ip4/0.0.0.0/tcp/4001
      - LISTEN_QUIC=/ip4/0.0.0.0/udp/4001/quic-v1
      - ENABLE_RELAY_CLIENT=${ENABLE_RELAY_CLIENT}
      - ENABLE_HOLEPUNCH=${ENABLE_HOLEPUNCH}
      - ENABLE_UPNP=${ENABLE_UPNP}
    ports:
      - "4001:4001/tcp"
      - "4001:4001/udp"
    volumes:
      - node1-data:/data
    depends_on:
      - relay

  node2:
    build: ./node
    container_name: p2p-node-2
    restart: unless-stopped
    environment:
      - APP_ROOM=${APP_ROOM}
      - RELAY_ADDR=${RELAY_ADDR}
      - LISTEN_TCP=/ip4/0.0.0.0/tcp/4001
      - LISTEN_QUIC=/ip4/0.0.0.0/udp/4001/quic-v1
      - ENABLE_RELAY_CLIENT=${ENABLE_RELAY_CLIENT}
      - ENABLE_HOLEPUNCH=${ENABLE_HOLEPUNCH}
      - ENABLE_UPNP=${ENABLE_UPNP}
    ports:
      - "4002:4001/tcp"
      - "4002:4001/udp"
    volumes:
      - node2-data:/data
    depends_on:
      - relay

volumes:
  relay-data:
  node1-data:
  node2-data:
